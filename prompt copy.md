A CHROME MANIFEST V3 EXTENSION THAT READS THE CURRENT PAGE, AND OFFERS A POPUP UI THAT HAS THE PAGE TITLE+CONTENT AND A TEXTAREA FOR A PROMPT (WITH A DEFAULT VALUE WE SPECIFY). WHEN THE USER HITS SUBMIT, IT SENDS THE PAGE TITLE+CONTENT TO THE ANTHROPIC CLAUDE API ALONG WITH THE UP TO DATE PROMPT TO SUMMARIZE IT. THE USER CAN MODIFY THAT PROMPT AND RE-SEND THE PROMPT+CONTENT TO GET ANOTHER SUMMARY VIEW OF THE CONTENT.

- ONLY WHEN CLICKED:
  - IT INJECTS A CONTENT SCRIPT `CONTENT_SCRIPT.JS` ON THE CURRENTLY OPEN TAB, AND ACCESSES THE TITLE `PAGETITLE` AND MAIN CONTENT (INNERTEXT) `PAGECONTENT` OF THE CURRENTLY OPEN PAGE 
  (EXTRACTED VIA AN INJECTED CONTENT SCRIPT, AND SENT OVER USING A `STOREPAGECONTENT` ACTION) 
  - IN THE BACKGROUND, RECEIVES THE `STOREPAGECONTENT` DATA AND STORES IT
  - ONLY ONCE THE NEW PAGE CONTENT IS STORED, THEN IT POPS UP A FULL HEIGHT WINDOW WITH A MINIMALISTIC STYLED HTML POPUP
  - IN THE POPUP SCRIPT
    - THE POPUP SHOULD DISPLAY A 10PX TALL ROUNDED CSS ANIMATED RED AND WHITE CANDY STRIPE LOADING INDICATOR `LOADINGINDICATOR`, WHILE WAITING FOR THE ANTHROPIC API TO RETURN
      - WITH THE CURRENTLY FETCHING PAGE TITLE AND A RUNNING TIMER IN THE CENTER SHOWING TIME ELAPSED SINCE CALL STARTED
      - DO NOT SHOW IT UNTIL THE API CALL BEGINS, AND HIDE IT WHEN IT ENDS.
    - RETRIEVES THE PAGE CONTENT DATA USING A `GETPAGECONTENT` ACTION (AND THE BACKGROUND LISTENS FOR THE `GETPAGECONTENT` ACTION AND RETRIEVES THAT DATA) AND DISPLAYS THE TITLE AT THE TOP OF THE POPUP
    - CHECK EXTENSION STORAGE FOR AN `APIKEY`, AND IF IT ISN'T STORED, ASKS FOR AN API KEY TO ANTHROPIC CLAUDE AND STORES IT.
    - AT THE BOTTOM OF THE POPUP, SHOW A VERTICALLY RESIZABLE FORM THAT HAS:
      - A 2 LINE TEXTAREA WITH AN ID AND LABEL OF `USERPROMPT`
        - `USERPROMPT` HAS A DEFAULT VALUE OF
            ```JS
            DEFAULTPROMPT = `PLEASE PROVIDE A DETAILED, EASY TO READ HTML SUMMARY OF THE GIVEN CONTENT`;
            ```JS
      - A 4 LINE TEXTAREA WITH AN ID AND LABEL OF `STYLEPROMPT`
        - `STYLEPROMPT` HAS A DEFAULT VALUE OF
            ```JS
            DEFAULTSTYLE = `RESPOND WITH 3-4 HIGHLIGHTS PER SECTION WITH IMPORTANT KEYWORDS, PEOPLE, NUMBERS, AND FACTS BOLDED IN THIS HTML FORMAT:
            
            <H1>{TITLE HERE}</H1>
            <H3>{SECTION TITLE HERE}</H3>
            <DETAILS>
              <SUMMARY>{SUMMARY OF THE SECTION WITH <STRONG>IMPORTANT KEYWORDS, PEOPLE, NUMBERS, AND FACTS BOLDED</STRONG> AND KEY QUOTES REPEATED}</SUMMARY>
              <UL>
                <LI><STRONG>{FIRST POINT}</STRONG>: {SHORT EXPLANATION WITH <STRONG>IMPORTANT KEYWORDS, PEOPLE, NUMBERS, AND FACTS BOLDED</STRONG>}</LI>
                <LI><STRONG>{SECOND POINT}</STRONG>: {SAME AS ABOVE}</LI>
                <LI><STRONG>{THIRD POINT}</STRONG>: {SAME AS ABOVE}</LI>
                <!-- A FOURTH POINT IF WARRANTED -->
              </UL>
            </DETAILS>
            <H3>{SECOND SECTION HERE}</H3>
            <P>{SUMMARY OF THE SECTION WITH <STRONG>IMPORTANT KEYWORDS, PEOPLE, NUMBERS, AND FACTS BOLDED</STRONG> AND KEY QUOTES REPEATED}</P>
            <DETAILS>
              <SUMMARY>{SUMMARY OF THE SECTION WITH <STRONG>IMPORTANT KEYWORDS, PEOPLE, NUMBERS, AND FACTS BOLDED</STRONG> AND KEY QUOTES REPEATED}</SUMMARY>
              <UL>
                <!-- AS MANY POINTS AS WARRANTED IN THE SAME FORMAT AS ABOVE -->
              </UL>
            </DETAILS>
            <H3>{THIRD SECTION HERE}</H3>
            <!-- AND SO ON, AS MANY SECTIONS AND DETAILS/SUMMARY SUBPOINTS AS WARRANTED -->

            WITH ALL THE WORDS IN BRACKETS REPLACED BY THE SUMMARY OF THE CONTENT. SANITIZE NON VISUAL HTML TAGS WITH HTML ENTITIES, SO <TEMPLATE> BECOMES &LT;TEMPLATE&GT; BUT <STRONG> STAYS THE SAME. ONLY DRAW FROM THE SOURCE CONTENT, DO NOT HALLUCINATE. FINALLY, END WITH OTHER QUESTIONS THAT THE USER MIGHT WANT ANSWERED BASED ON THIS SOURCE CONTENT:

            <HR>
            <H2>NEXT PROMPTS</H2>
            <UL>
              <LI>{QUESTION 1}</LI>
              <LI>{QUESTION 2}</LI>
              <LI>{QUESTION 3}</LI>
            </UL>`;
            ```JS
      - AND IN THE LAST ROW, ON EITHER SIDE,
        - AND A NICELY STYLED SUBMIT BUTTON WITH AN ID OF `SENDBUTTON` (TACTILE STYLING THAT "DEPRESSES" ON CLICK)
      - ONLY WHEN `SENDBUTTON` IS CLICKED, CALLS THE ANTHROPIC MODEL ENDPOINT HTTPS://API.ANTHROPIC.COM/V1/COMPLETE WITH: 
        - APPEND THE PAGE TITLE
        - APPEND THE PAGE CONTENT
        - ADD THE PROMPT WHICH IS A CONCATENATION OF
            ```JS
            FINALPROMPT = `HUMAN: ${USERPROMPT} \N\N ${STYLEPROMPT} \N\N ASSISTANT:`
            ```
        - AND USE THE `CLAUDE-INSTANT-V1` MODEL (IF `PAGECONTENT` IS <70K WORDS) OR THE `CLAUDE-INSTANT-V1-100K` MODEL (IF MORE) 
        - REQUESTING MAX TOKENS = THE HIGHER OF (25% OF THE LENGTH OF THE PAGE CONTENT, OR 750 WORDS)
        - IF ANOTHER SUBMIT EVENT IS HIT WHILE THE PREVIOUS API CALL IS STILL INFLIGHT, CANCEL THAT AND START THE NEW ONE
    - RENDERS THE ANTHROPIC-GENERATED RESULT AT THE TOP OF THE POPUP IN A DIV WITH AN ID OF `CONTENT`

IMPORTANT DETAILS:

- IT HAS TO RUN IN A BROWSER ENVIRONMENT, SO NO NODEJS APIS ALLOWED.

- THE RETURN SIGNATURE OF THE ANTHROPIC API IS CURL HTTPS://API.ANTHROPIC.COM/V1/COMPLETE\
  -H "X-API-KEY: $API_KEY"\
  -H 'CONTENT-TYPE: APPLICATION/JSON'\
  -D '{
    "PROMPT": "\N\NHUMAN: TELL ME A HAIKU ABOUT TREES\N\NASSISTANT: ",
    "MODEL": "CLAUDE-V1", "MAX_TOKENS_TO_SAMPLE": 1000, "STOP_SEQUENCES": ["\N\NHUMAN:"]
  }'
{"COMPLETION":" HERE IS A HAIKU ABOUT TREES:\N\NSILENT SENTINELS, \NSTANDING SOLEMN IN THE WOODS,\NBRANCHES REACHING SKY.","STOP":"\N\NHUMAN:","STOP_REASON":"STOP_SEQUENCE","TRUNCATED":FALSE,"LOG_ID":"F5D95CF326A4AC39EE36A35F434A59D5","MODEL":"CLAUDE-V1","EXCEPTION":NULL}

- IN THE STRING PROMPT SENT TO ANTHROPIC, FIRST INCLUDE THE PAGE TITLE AND PAGE CONTENT, AND FINALLY APPEND THE PROMPT, CLEARLY VERTICALLY SEPARATED BY SPACING.

- IF THE ANTHROPIC API CALL IS A 401, HANDLE THAT BY CLEARING THE STORED ANTHROPIC API KEY AND ASKING FOR IT AGAIN.

- ADD STYLES TO MAKE SURE THE POPUP'S STYLING FOLLOWS THE BASIC RULES OF WEB DESIGN, FOR EXAMPLE HAVING MARGINS AROUND THE BODY, AND A SYSTEM FONT STACK.

- STYLE THE POPUP BODY WITH <LINK REL="STYLESHEET" HREF="HTTPS://UNPKG.COM/MVP.CSS@1.12/MVP.CSS"> BUT INSIST ON BODY MARGINS OF 16 AND A MINIMUM WIDTH OF 400 AND HEIGHT OF 600.

## DEBUGGING NOTES

INSIDE OF BACKGROUND.JS, JUST TAKE THE GETPAGECONTENT RESPONSE DIRECTLY

```JS
CHROME.RUNTIME.ONMESSAGE.ADDLISTENER((REQUEST, SENDER, SENDRESPONSE) => {
  IF (REQUEST.ACTION === 'STOREPAGECONTENT') {
    // DONT ACCESS REQUEST.PAGECONTENT
    CHROME.STORAGE.LOCAL.SET({ PAGECONTENT: REQUEST }, () => {
      SENDRESPONSE({ SUCCESS: TRUE });
    });
  } ELSE IF (REQUEST.ACTION === 'GETPAGECONTENT') {
    CHROME.STORAGE.LOCAL.GET(['PAGECONTENT'], (RESULT) => {
      // DONT ACCESS REQUEST.PAGECONTENT
      SENDRESPONSE(RESULT);
    });
  }
  RETURN TRUE;
});
```

INSIDE OF POPUP.JS, UPDATE THE FUNCTION CALLS TO `REQUESTANTHROPICSUMMARY`
IN `POPUP.JS` TO PASS THE `APIKEY`:

```JAVASCRIPT
CHROME.STORAGE.LOCAL.GET(['APIKEY'], (RESULT) => {
  CONST APIKEY = RESULT.APIKEY;
  REQUESTANTHROPICSUMMARY(DEFAULTPROMPT, APIKEY);
});

SENDBUTTON.ADDEVENTLISTENER('CLICK', () => {
  CHROME.STORAGE.LOCAL.GET(['APIKEY'], (RESULT) => {
    CONST APIKEY = RESULT.APIKEY;
    REQUESTANTHROPICSUMMARY(USERPROMPT.VALUE, APIKEY);
  });
});
```

IN `POPUP.JS`, STORE THE DEFAULTPROMPT AT THE TOP LEVEL.
ALSO, GIVE A HTML FORMAT TO THE ANTHROPIC PROMPT
